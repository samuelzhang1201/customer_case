{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.2", "generated_at": "2023-11-18T04:04:48.241872Z", "invocation_id": "09a375b1-409d-41b6-a95c-6e62b6822a92", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-18T04:04:47.571397Z", "completed_at": "2023-11-18T04:04:47.576902Z"}, {"name": "execute", "started_at": "2023-11-18T04:04:47.576902Z", "completed_at": "2023-11-18T04:04:47.690426Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.12102818489074707, "adapter_response": {"_message": "SELECT 11", "code": "SELECT", "rows_affected": 11}, "message": "SELECT 11", "failures": null, "unique_id": "model.customer360.stg_sf__contacts", "compiled": true, "compiled_code": "with source as (\n    select * from \"dbt\".\"public\".\"contacts\"\n),\n\nrenamed as (\n    select\n        id,\n        case \n            when row_number() over(partition by id)>1 then concat(id,'-',row_number() over(partition by id)) \n            else id end as new_id,\n        username as user_name,\n        name,\n        gender,\n        address, \n        mail as email_address,\n        birthdate as birth_date,\n        _loaded_at_utc,\n        now() as updated_at\n    from source     \n)\n\nselect * from renamed", "relation_name": "\"dbt\".\"staging\".\"stg_sf__contacts\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-18T04:04:47.698651Z", "completed_at": "2023-11-18T04:04:47.706653Z"}, {"name": "execute", "started_at": "2023-11-18T04:04:47.719651Z", "completed_at": "2023-11-18T04:04:47.854806Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.16315412521362305, "adapter_response": {"_message": "INSERT 0 0", "code": "INSERT", "rows_affected": 0}, "message": "INSERT 0 0", "failures": null, "unique_id": "model.customer360.stg_web__transactions", "compiled": true, "compiled_code": "\n\n\nwith source as (\n    select * from \"dbt\".\"public\".\"transactions\"\n\n\n\n  where _loaded_at_utc > (select max(_loaded_at_utc) from \"dbt\".\"staging\".\"stg_web__transactions\")\n\n\n\n),\n\nrenamed as (\n    select\n        id,\n        contact_id,\n        \n\n    \n\n        to_timestamp(transaction_date,'YYYY-MM-DD HH24:MI:SS.MS') :: timestamp at TIME zone 'UTC'\n\n    \n\n as transaction_date,\n        amount,\n        item_count,\n        category, \n        _loaded_at_utc,\n        '09a375b1-409d-41b6-a95c-6e62b6822a92' as batch_id\n    from source\n    where contact_id in (select new_id from \"dbt\".\"staging\".\"stg_sf__contacts\")       \n)\n\nselect * from renamed", "relation_name": "\"dbt\".\"staging\".\"stg_web__transactions\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-18T04:04:47.696652Z", "completed_at": "2023-11-18T04:04:47.706653Z"}, {"name": "execute", "started_at": "2023-11-18T04:04:47.707653Z", "completed_at": "2023-11-18T04:04:47.860809Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.16715669631958008, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.customer360.masked_contact", "compiled": true, "compiled_code": "\n\nwith mask_data as (\nselect\n\tid,\n\tnew_id,\n\tuser_name,\n\t\"name\",\n\tgender,\n\taddress,\n    concat('***',substr(email_address, position('@' in email_address))) AS email_address,\n\tbirth_date,\n\t\"_loaded_at_utc\",\n\tupdated_at\nfrom\n    \"dbt\".\"staging\".\"stg_sf__contacts\"\n)\nselect * from mask_data", "relation_name": "\"dbt\".\"staging\".\"masked_contact\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-18T04:04:47.868810Z", "completed_at": "2023-11-18T04:04:47.873810Z"}, {"name": "execute", "started_at": "2023-11-18T04:04:47.877319Z", "completed_at": "2023-11-18T04:04:47.949318Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.08450794219970703, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.customer360.contacts_joined_with_transactions", "compiled": true, "compiled_code": "SELECT \n    contacts.*,\n    transactions.id as transaction_id,\n    transactions.transaction_date,\n    transactions.amount,\n    transactions.item_count,\n    transactions.category\nFROM \"dbt\".\"staging\".\"stg_web__transactions\" as transactions\nLEFT JOIN \"dbt\".\"staging\".\"stg_sf__contacts\" as contacts ON contacts.new_id = transactions.contact_id", "relation_name": "\"dbt\".\"marts\".\"contacts_joined_with_transactions\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-18T04:04:47.870809Z", "completed_at": "2023-11-18T04:04:47.873810Z"}, {"name": "execute", "started_at": "2023-11-18T04:04:47.880317Z", "completed_at": "2023-11-18T04:04:47.992444Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.12663483619689941, "adapter_response": {"_message": "SELECT 20", "code": "SELECT", "rows_affected": 20}, "message": "SELECT 20", "failures": null, "unique_id": "model.customer360.cross_shopping", "compiled": true, "compiled_code": "with combo as (\nselect\n\ta.contact_id,\n\ta.category as cate_01\n\t, b.category as cate_02\nfrom\n\t\"dbt\".\"staging\".\"stg_web__transactions\" a \njoin \n    \"dbt\".\"staging\".\"stg_web__transactions\" b\non a.contact_id = b.contact_id \nand a.category > b.category \n)\nselect \ncate_01\n,cate_02\n, count(distinct contact_id)\nfrom\ncombo\ngroup by 1,2\norder by 3 desc", "relation_name": "\"dbt\".\"marts\".\"cross_shopping\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-18T04:04:47.875314Z", "completed_at": "2023-11-18T04:04:47.883317Z"}, {"name": "execute", "started_at": "2023-11-18T04:04:47.885319Z", "completed_at": "2023-11-18T04:04:48.025761Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.15395021438598633, "adapter_response": {"_message": "SELECT 32", "code": "SELECT", "rows_affected": 32}, "message": "SELECT 32", "failures": null, "unique_id": "model.customer360.next_category", "compiled": true, "compiled_code": "with next_purcase as (\nselect\n\tcontact_id,\n\ttransaction_date,\n\titem_count,\n\tcategory,\n\tlead(category) over(partition by contact_id order by transaction_date ) as next_category\nfrom\n\t\"dbt\".\"staging\".\"stg_web__transactions\"\n)\nselect \ncategory \n, next_category\n, count(distinct contact_id) as cust_count\nfrom \nnext_purcase\nwhere next_category is not null\ngroup by 1,2", "relation_name": "\"dbt\".\"marts\".\"next_category\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-18T04:04:47.954318Z", "completed_at": "2023-11-18T04:04:47.959318Z"}, {"name": "execute", "started_at": "2023-11-18T04:04:47.960318Z", "completed_at": "2023-11-18T04:04:48.177724Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.22440528869628906, "adapter_response": {"_message": "SELECT 9", "code": "SELECT", "rows_affected": 9}, "message": "SELECT 9", "failures": null, "unique_id": "model.customer360.customers", "compiled": true, "compiled_code": "with intermediate as (\nSELECT\n    new_id,\n    gender,\n    first_value (transaction_date::date) over(partition by id order by transaction_date) as first_purchase_date,\n    last_value (transaction_date::date) over(partition by id order by transaction_date rows between unbounded preceding and unbounded following) as last_purchase_date,\n    \n\n    \n\n        date_part('year', age(current_date,birth_date))\n\n    \n\n AS age,\n    case when category = 'Apps & Games' then amount else 0 end as \"Apps & Games_amount\"\n    ,case when category = 'Beauty' then amount else 0 end as \"Beauty_amount\"\n    ,case when category = 'Books' then amount else 0 end as \"Books_amount\"\n    ,case when category = 'Clothing, Shoes & Accessories' then amount else 0 end as \"Clothing, Shoes & Accessories_amount\"\n    ,case when category = 'Movies & TV' then amount else 0 end as \"Movies & TV_amount\"\n    ,case when category = 'Sports, Fitness & Outdoors' then amount else 0 end as \"Sports, Fitness & Outdoors_amount\"\n    ,case when category = 'Kitchen' then amount else 0 end as \"Kitchen_amount\"\n    \nFROM \"dbt\".\"marts\".\"contacts_joined_with_transactions\"\n)\n, final as (\nselect \n    new_id,\n    gender,\n    first_purchase_date,\n    last_purchase_date,\n    age,\n    sum(\"Apps & Games_amount\") as \"Apps & Games_amount\"\n    ,sum(\"Beauty_amount\") as \"Beauty_amount\"\n    ,sum(\"Books_amount\") as \"Books_amount\"\n    ,sum(\"Clothing, Shoes & Accessories_amount\") as \"Clothing, Shoes & Accessories_amount\"\n    ,sum(\"Movies & TV_amount\") as \"Movies & TV_amount\"\n    ,sum(\"Sports, Fitness & Outdoors_amount\") as \"Sports, Fitness & Outdoors_amount\"\n    ,sum(\"Kitchen_amount\") as \"Kitchen_amount\"\n    \nFROM intermediate \ngroup by \n1,2,3,4,5\n)\nselect * from final", "relation_name": "\"dbt\".\"marts\".\"customers\""}], "elapsed_time": 0.9858353137969971, "args": {"exclude": [], "show_resource_report": false, "enable_legacy_logger": false, "macro_debugging": false, "vars": {}, "log_format": "default", "invocation_command": "dbt run", "quiet": false, "defer": false, "log_level": "info", "introspect": true, "select": [], "printer_width": 80, "indirect_selection": "eager", "static_parser": true, "log_format_file": "debug", "print": true, "warn_error_options": {"include": [], "exclude": []}, "log_level_file": "debug", "partial_parse": true, "log_file_max_bytes": 10485760, "log_path": "C:\\Users\\Samuel\\Desktop\\customer360\\integration_tests\\logs", "partial_parse_file_diff": true, "send_anonymous_usage_stats": true, "strict_mode": false, "version_check": true, "favor_state": false, "which": "run", "profiles_dir": "C:\\Users\\Samuel\\Desktop\\customer360\\integration_tests", "use_colors": true, "project_dir": "C:\\Users\\Samuel\\Desktop\\customer360\\integration_tests", "use_colors_file": true, "write_json": true, "populate_cache": true, "cache_selected_only": false}}